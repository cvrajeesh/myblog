<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>rajeesh</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description">
<meta property="og:type" content="website">
<meta property="og:title" content="rajeesh">
<meta property="og:url" content="http://rajeeshcv.com/page/2/index.html">
<meta property="og:site_name" content="rajeesh">
<meta property="og:description">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="rajeesh">
<meta name="twitter:description">
<meta name="twitter:creator" content="@cvrajeesh">
<link rel="publisher" href="https://www.google.com/+RajeeshCV">
  
    <link rel="alternative" href="/atom.xml" title="rajeesh" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  <link rel="stylesheet" href="/css/style.css" type="text/css">
  
<!-- Google Analytics -->
<script type="text/javascript">
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-647217-9', 'auto');
ga('send', 'pageview');

</script>
<!-- End Google Analytics -->


</head>
<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">rajeesh</a>
      </h1>
      
        <h2 id="subtitle-wrap">
          <a href="/" id="subtitle">Sharing My Thoughts</a>
        </h2>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/about">About</a>
        
          <a class="main-nav-link" href="/projects">Projects</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" results="0" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://rajeeshcv.com"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main">
  
    <article id="post-Attach-to-Any-ASP-NET-Web-Server-from-Visual-Studio-in-One-Click" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2011/11/30/Attach-to-Any-ASP-NET-Web-Server-from-Visual-Studio-in-One-Click/" class="article-date">
  <time datetime="2011-11-30T06:25:45.000Z" itemprop="datePublished">2011-11-30</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2011/11/30/Attach-to-Any-ASP-NET-Web-Server-from-Visual-Studio-in-One-Click/">Attach to Any ASP.NET Web Server from Visual Studio in One Click</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>This is an update to my previous blog post <a href="/2011/11/26/Attach-to-Visual-Studio-Development-Server-with-One-Click/" title="Attach to Visual Studio Development Server with One Click">Attach to Visual Studio Development Server with One Click</a>.</p>
<p>The Visual Studio Macro from previous article doesn’t support IISExpress or IIS; it only supported the Visual Studio Development Server, more over it doesn’t detect latest Development Web Server <em>WebDev.WebServer40.exe</em>.</p>
<p>Now I have updated the Macro so that it will automatically detect the Web Server setting from the project properties and attach it accordingly.</p>
<p>Below is the code for the new Macro, I think it is self-explanatory</p>
<figure class="highlight vb"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">Public</span> <span class="keyword">Sub</span> AttachToWebServer()</span><br><span class="line">    <span class="keyword">Dim</span> attached <span class="keyword">As</span> <span class="built_in">Boolean</span> = <span class="literal">False</span></span><br><span class="line">    <span class="keyword">Dim</span> project <span class="keyword">As</span> EnvDTE.Project = GetStartupProject()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">If</span> (project <span class="keyword">Is</span> <span class="literal">Nothing</span>) <span class="keyword">Then</span></span><br><span class="line">        MsgBox(<span class="string">"Couldn't find a web project that can be attached"</span>)</span><br><span class="line">        <span class="keyword">Return</span></span><br><span class="line">    <span class="keyword">End</span> <span class="keyword">If</span></span><br><span class="line"></span><br><span class="line">    attached = AttachToProcess(project)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">If</span> (<span class="keyword">Not</span> attached) <span class="keyword">Then</span></span><br><span class="line">        MsgBox(<span class="string">"Couldn't attach to the process"</span>)</span><br><span class="line">    <span class="keyword">End</span> <span class="keyword">If</span></span><br><span class="line"><span class="keyword">End</span> <span class="keyword">Sub</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">Private</span> <span class="keyword">Function</span> GetStartupProject() <span class="keyword">As</span> EnvDTE.Project</span><br><span class="line">    <span class="keyword">Dim</span> startUpProject <span class="keyword">As</span> <span class="built_in">String</span> = DTE.Solution.Properties.Item(<span class="string">"StartupProject"</span>).Value</span><br><span class="line"></span><br><span class="line">    <span class="keyword">For</span> <span class="keyword">Each</span> currentProject <span class="keyword">As</span> EnvDTE.Project <span class="keyword">In</span> DTE.Solution.Projects</span><br><span class="line">        <span class="keyword">If</span> currentProject.Name = startUpProject <span class="keyword">Then</span></span><br><span class="line">            <span class="keyword">Return</span> currentProject</span><br><span class="line">        <span class="keyword">End</span> <span class="keyword">If</span></span><br><span class="line">    <span class="keyword">Next</span></span><br><span class="line">    <span class="keyword">Return</span> <span class="literal">Nothing</span></span><br><span class="line"><span class="keyword">End</span> <span class="keyword">Function</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">Private</span> <span class="keyword">Function</span> AttachToProcess(<span class="keyword">ByVal</span> project <span class="keyword">As</span> EnvDTE.Project) <span class="keyword">As</span> <span class="built_in">Boolean</span></span><br><span class="line">    <span class="keyword">Dim</span> serverProcessNamePattern <span class="keyword">As</span> <span class="built_in">String</span></span><br><span class="line">    <span class="comment">' Using either IIS express or IIS</span></span><br><span class="line">    <span class="keyword">If</span> project.Properties.Item(<span class="string">"WebApplication.UseIIS"</span>).Value = <span class="string">"True"</span> <span class="keyword">Then</span></span><br><span class="line">        <span class="comment">' Using IIS Express</span></span><br><span class="line">        <span class="keyword">If</span> project.Properties.Item(<span class="string">"WebApplication.DevelopmentServerCommandLine"</span>).Value.ToString().Length &gt; <span class="number">0</span> <span class="keyword">Then</span></span><br><span class="line">            serverProcessNamePattern = <span class="string">".*iisexpress.exe"</span></span><br><span class="line">        <span class="keyword">Else</span> <span class="comment">' Real IIS</span></span><br><span class="line">            serverProcessNamePattern = <span class="string">".*w3wp.exe"</span></span><br><span class="line">        <span class="keyword">End</span> <span class="keyword">If</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">Else</span> <span class="comment">' Assume development web server</span></span><br><span class="line">        serverProcessNamePattern = <span class="string">".*WebDev.WebServer\d+.EXE"</span></span><br><span class="line">    <span class="keyword">End</span> <span class="keyword">If</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">Return</span> AttachToWebServer(serverProcessNamePattern)</span><br><span class="line"></span><br><span class="line"><span class="keyword">End</span> <span class="keyword">Function</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">Private</span> <span class="keyword">Function</span> AttachToWebServer(<span class="keyword">ByVal</span> serverProcessNamePattern <span class="keyword">As</span> <span class="built_in">String</span>) <span class="keyword">As</span> <span class="built_in">Boolean</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">Dim</span> attached <span class="keyword">As</span> <span class="built_in">Boolean</span> = <span class="literal">False</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">For</span> <span class="keyword">Each</span> process <span class="keyword">In</span> DTE.Debugger.LocalProcesses</span><br><span class="line">        <span class="keyword">If</span> (Regex.IsMatch(process.Name, serverProcessNamePattern)) <span class="keyword">Then</span></span><br><span class="line">            process.Attach()</span><br><span class="line">            attached = <span class="literal">True</span></span><br><span class="line">            <span class="keyword">Exit</span> <span class="keyword">For</span></span><br><span class="line">        <span class="keyword">End</span> <span class="keyword">If</span></span><br><span class="line">    <span class="keyword">Next</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">Return</span> attached</span><br><span class="line"><span class="keyword">End</span> <span class="keyword">Function</span></span><br></pre></td></tr></table></figure>
<p>Read my previous article <a href="/2011/11/26/Attach-to-Visual-Studio-Development-Server-with-One-Click/" title="Attach to Visual Studio Development Server with One Click">Attach to Visual Studio Development Server with One Click</a> to understand how we can add this Macro as command to the Visual Studio toolbar.</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://rajeeshcv.com/2011/11/30/Attach-to-Any-ASP-NET-Web-Server-from-Visual-Studio-in-One-Click/" data-id="ciffni8wd0010isktvspkr3ro" class="article-share-link">Share</a>
      
        <a href="http://rajeeshcv.com/2011/11/30/Attach-to-Any-ASP-NET-Web-Server-from-Visual-Studio-in-One-Click/#disqus_thread" class="article-comment-link">Comments</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-Attach-to-Visual-Studio-Development-Server-with-One-Click" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2011/11/26/Attach-to-Visual-Studio-Development-Server-with-One-Click/" class="article-date">
  <time datetime="2011-11-26T06:14:24.000Z" itemprop="datePublished">2011-11-26</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2011/11/26/Attach-to-Visual-Studio-Development-Server-with-One-Click/">Attach to Visual Studio Development Server with One Click</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>In my day to day work, during the development I had to attach an ASP.NET application to the development server (Cassini) several times in order to debug and fix a problem.</p>
<p>This task is little bit time consuming because this is how we normally do it</p>
<ol>
<li>Click on the “Attach to Process” menu under the Debug menu</li>
<li>Select the correct process from the list of available processes</li>
<li>Either double click on the select process or click the “Attach” button</li>
</ol>
<p>You can reduce these into two steps, if you assign a short cut key to the <em>Attach to Process</em> command.</p>
<p>What I found is, most of the time is lost for finding and selecting the correct process from the available list of processes in the <em>Attach to Process</em> dialog.</p>
<p>So in order to be more productive, I have created a macro which will automatically attach to the Visual Studio Development Server automatically, saves your time from scroll through the big list of processes.</p>
<p>Below is the code for this macro</p>
<figure class="highlight vb"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">Public</span> <span class="keyword">Sub</span> AttachToDevelopmentServer()</span><br><span class="line">    <span class="keyword">Dim</span> attached <span class="keyword">As</span> <span class="built_in">Boolean</span> = <span class="literal">False</span></span><br><span class="line">    <span class="keyword">Dim</span> process <span class="keyword">As</span> EnvDTE.Process</span><br><span class="line">    <span class="keyword">For</span> <span class="keyword">Each</span> process <span class="keyword">In</span> DTE.Debugger.LocalProcesses</span><br><span class="line">        <span class="keyword">If</span> (process.Name.EndsWith(<span class="string">"WebDev.WebServer20.EXE"</span>)) <span class="keyword">Then</span></span><br><span class="line">            process.Attach()</span><br><span class="line">            attached = <span class="literal">True</span></span><br><span class="line">            <span class="keyword">Exit</span> <span class="keyword">For</span></span><br><span class="line">        <span class="keyword">End</span> <span class="keyword">If</span></span><br><span class="line">    <span class="keyword">Next</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">If</span> (<span class="keyword">Not</span> attached) <span class="keyword">Then</span></span><br><span class="line">        MsgBox(<span class="string">"Couldn't attach to the process"</span>)</span><br><span class="line">    <span class="keyword">End</span> <span class="keyword">If</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">End</span> <span class="keyword">Sub</span></span><br></pre></td></tr></table></figure>
<p>If you don’t know to how to create a macro, these are the steps for doing it</p>
<ol>
<li>In Visual Studio Go To the Tools menu</li>
<li>Then select the Macros and then Macros IDE (Short cut is Alt+F11). This will open up a new IDE similar to Visual Studio.</li>
<li>In the project explorer under <em>My Macros</em> you will see <em>My Module</em> or you can create a new module by right clicking on the project, then Add -&gt; Add Module. In my case I created a new module and called it as <em>Extensions</em></li>
<li>Copy and paste above subroutine to that module.</li>
</ol>
<p>Now we have to execute the newly created macros on clicking on a toolbar button. For that, follow these steps</p>
<ol>
<li>In Visual Studio, go to the Tool menu, under that select the Customize menu. This will open up the Customize dialog</li>
<li>Select the Commands tab</li>
<li>Select the Toolbar checkbox and then select the Toolbar on which you want this button to appear from dropdown list. I chose the <em>Standard Toolbar</em></li>
<li>Now click on the “Add Command” button. Then select the Macros from the categories in the <em>Add Command</em> dialog.</li>
<li>Now you will see the list of available macros on the list box on. From that list select your Macro <em>AttachToDevelopmentServer</em> and click OK</li>
<li>If you want, you can customize the text which appears on the command button, by clicking on the <em>Modify Selection</em><br>Here it is how it looked in my machine</li>
</ol>
<p><img src="http://cdn.rajeeshcv.com/images/2011/11/20111126012529_AddCommand_thumb.png" alt="Adding Command to the Visual Studio Toolbar"></p>
<p>That’s it, now you will be able to new button appeared in the standard toolbar. If you click on that, it will automatically attach your web project to the running application in the development server.</p>
<p><img src="http://cdn.rajeeshcv.com/images/2011/11/20111126012540_AttachToProcess_thumb.png" alt="Visual Studio Toolbar after Customization"></p>
<p><strong>Note:</strong> There are couples of problems here</p>
<ol>
<li>This doesn’t work if you have set the IIS Express/IIS itself as the server for running the application.( <em>Update:</em> A new macro to support this feature is exlplained here <a href="/2011/11/30/Attach-to-Any-ASP-NET-Web-Server-from-Visual-Studio-in-One-Click/" title="Attach to Any ASP.NET Web Server from Visual Studio in One Click">Attach to Any ASP.NET Web Server from Visual Studio in One Click</a> )</li>
<li>If you have multiple web applications in your project, it will attach to the first development server. So I suggest you to read my previous post about <a href="/2011/11/24/Multiple-Visual-Studio-Development-Servers-while-Debugging/" title="disabling multiple Visual Studio development webservers">disabling multiple Visual Studio development webservers</a></li>
</ol>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://rajeeshcv.com/2011/11/26/Attach-to-Visual-Studio-Development-Server-with-One-Click/" data-id="ciffni8wd000ziskti0be4f0h" class="article-share-link">Share</a>
      
        <a href="http://rajeeshcv.com/2011/11/26/Attach-to-Visual-Studio-Development-Server-with-One-Click/#disqus_thread" class="article-comment-link">Comments</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-Multiple-Visual-Studio-Development-Servers-while-Debugging" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2011/11/24/Multiple-Visual-Studio-Development-Servers-while-Debugging/" class="article-date">
  <time datetime="2011-11-24T10:03:44.000Z" itemprop="datePublished">2011-11-24</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2011/11/24/Multiple-Visual-Studio-Development-Servers-while-Debugging/">Multiple Visual Studio Development Servers while Debugging</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>You might have noticed that when you start debugging an ASP.NET web application, it start more than one visual studio development servers and in the system tray you see something like this</p>
<p><img src="http://cdn.rajeeshcv.com/images/2011/11/20111124063108_Mutiple_development_server_2.png" alt="Multiple Development Servers"></p>
<p>This happens when your solution contains more than one web application, setting one as the StartUp project is not going to help..</p>
<p>The reason for this is - by default any web application is set to start when we trigger the debugging process in visual studio. We need to disable that auto start feature so that only one visual studio development server is getting started when we are debugging.</p>
<p>These are the steps for disabling it</p>
<ol>
<li>Select the web project which you don’t want to start</li>
<li>Go to the properties window (Shortcut – press F4)</li>
<li>Set “Always Start When Debugging” to False</li>
</ol>
<p><img src="http://cdn.rajeeshcv.com/images/2011/11/20111124063119_Disable_Start_When_Debuggin_thumb.png" alt="Disable always start"></p>
<p>This is how you could do it in Visual studio 2010, I hope the same applies to Visual studio 2008 too. Now if you start debugging, you will see only one development webserver.</p>
<p>Hope this helps</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://rajeeshcv.com/2011/11/24/Multiple-Visual-Studio-Development-Servers-while-Debugging/" data-id="ciffni8s8000fiskterl2a948" class="article-share-link">Share</a>
      
        <a href="http://rajeeshcv.com/2011/11/24/Multiple-Visual-Studio-Development-Servers-while-Debugging/#disqus_thread" class="article-comment-link">Comments</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-Abstractions-can-also-put-you-in-Trouble" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2011/11/19/Abstractions-can-also-put-you-in-Trouble/" class="article-date">
  <time datetime="2011-11-19T09:55:05.000Z" itemprop="datePublished">2011-11-19</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2011/11/19/Abstractions-can-also-put-you-in-Trouble/">Abstractions can also put you in Trouble</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>We all have enjoyed the beauty of abstracting out functionality, so that it simplifies the underlying complexity. Sometimes it can come back and hit you on the forehead like a boomerang if we don’t know what is going underneath those hidden layers.</p>
<p>Recently it happened to me with the LINQ provider. If you have a data source then you can build your own Query provider on top of it, so that the users can access your data using the LINQ statements without understand how it is fetched.</p>
<p>For e.g. <a href="http://linqtotwitter.codeplex.com/" target="_blank" rel="external">Linq2Twitter</a> it provides the IQueryable interface which you can use fetch the twitter API without understanding the REST API’s exposed by the Twitter.</p>
<p>Similarly Ayende has created a Linq provider for NHibernate (<a href="https://nuget.org/List/Packages/NHibernate.Linq" target="_blank" rel="external">NHibernate.Linq</a>) which hides complexities of writing Criteria API’s.</p>
<p>This is what happened to me – we had a repository method which is using the NHibernate.Linq and it returned an IQueryable interface of domain model.</p>
<p>Like to the below code(only an example, this is not from the actual codebase itself)</p>
<figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> IQueryable&lt;Customer&gt; <span class="title">QueryableCustomers</span>(<span class="params"></span>)</span><br><span class="line"></span>&#123;</span><br><span class="line">    session = SessionFactory.OpenSession();</span><br><span class="line">    <span class="keyword">return</span> session.Linq&lt;Customer&gt;().AsQueryable();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>In the consumer part (Action method in the controller), we are filtering the customer with a name containing particular string using the Contains method</p>
<p><code>this.dataProvider.QueryableCustomers().Where(x =&gt; x.Name.Contains(&quot;custo&quot;)).ToList();</code></p>
<p>Everything worked as expected, but one day the filtering stopped working, I couldn’t figure it out initially, but when I looked into the <code>QueryableCustomers()</code> method, it has been changed to something like this</p>
<figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> IQueryable&lt;Customer&gt; <span class="title">QueryableCustomers</span>(<span class="params"></span>)</span><br><span class="line"></span>&#123;</span><br><span class="line">    session = SessionFactory.OpenSession();</span><br><span class="line">    <span class="keyword">return</span> session.Linq&lt;Customer&gt;().ToList().AsQueryable();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Not much difference in the code wise, but internally the earlier code will filter the customers using the SQL statement by adding a where clause to the SQL it generated and later one will fetch all the customers from the DB and filter that result using the LINQ on objects.</p>
<p>SQL generated for initial code</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator"><span class="keyword">SELECT</span></span><br><span class="line">    this_.<span class="keyword">Id</span> <span class="keyword">as</span> Id0_0_,</span><br><span class="line">    this_.<span class="keyword">Name</span> <span class="keyword">as</span> Name0_0_,</span><br><span class="line">    this_.Address <span class="keyword">as</span> Address0_0_</span><br><span class="line"><span class="keyword">FROM</span></span><br><span class="line">    Customer this_</span><br><span class="line"><span class="keyword">WHERE</span></span><br><span class="line">    this_.<span class="keyword">Name</span> <span class="keyword">like</span> @p0;</span></span><br><span class="line">@p0 = '%custo%'</span><br></pre></td></tr></table></figure>
<p>After code change, the query generated SQL was</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator"><span class="keyword">SELECT</span></span><br><span class="line">this_.<span class="keyword">Id</span> <span class="keyword">as</span> Id0_0_,</span><br><span class="line">this_.<span class="keyword">Name</span> <span class="keyword">as</span> Name0_0_,</span><br><span class="line">this_.Address <span class="keyword">as</span> Address0_0_</span><br><span class="line">  <span class="keyword">FROM</span></span><br><span class="line">Customer this_</span></span><br></pre></td></tr></table></figure>
<p>By now you might have realized the reason why the I didn’t get the expected result from the new code change – if not here is the explanation, <strong>Contains</strong> in the earlier code is translated by the NH LINQ provider to a where clause which is case insensitive by default unless you have set any specific Collation in the database or on the column itself but in the other hand new code returned a collection of Customer itself, then we applied String.Contains on the Name property which is case sensitive.</p>
<p>My point here is - we can’t blindly believe in the abstractions provided by anyone without understanding what is happening underneath.</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://rajeeshcv.com/2011/11/19/Abstractions-can-also-put-you-in-Trouble/" data-id="ciffni8wt0012isktb3498p7z" class="article-share-link">Share</a>
      
        <a href="http://rajeeshcv.com/2011/11/19/Abstractions-can-also-put-you-in-Trouble/#disqus_thread" class="article-comment-link">Comments</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-How-to-Move-Directories-Across-SVN-Repositories" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2011/11/15/How-to-Move-Directories-Across-SVN-Repositories/" class="article-date">
  <time datetime="2011-11-15T09:41:45.000Z" itemprop="datePublished">2011-11-15</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2011/11/15/How-to-Move-Directories-Across-SVN-Repositories/">How to Move Directories Across SVN Repositories</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>Recently we were restructuring our project repositories, where I had to move a project from it’s own repository to another repository.</p>
<p>When do a move under SVN you need to make sure that the history is not lost, so I will explain two common scenarios and how you could do the SVN move</p>
<h3 id="Scenario_1_-_Moving_files_or_directories_with_in_a_SVN_repository">Scenario 1 - Moving files or directories with in a SVN repository</h3><p>Below is a screen shot of my existing repository and I want to move the <strong>configuration</strong> directory to the <strong>project</strong>  directory without loosing the history.</p>
<p><img src="http://cdn.rajeeshcv.com/images/2011/11/20111115081425_Screen1_thumb.png" alt="SVN repository structure"></p>
<p>First of of all this will work only for the versioned items, so please commit your changes to the directory you want to move before doing this. The steps explained below assumes that you are using Tortoise SVN</p>
<p>Here are the steps</p>
<ol>
<li>Right click on the directory you want to move</li>
<li>Drag and drop on to the directory where you want to move this.</li>
<li>Choose the <strong>SVN Mover Versioned item(s) here</strong> item from the context menu.<br><img src="http://cdn.rajeeshcv.com/images/2011/11/20111115081432_Screen2_thumb.png" alt="Context Menu with move"></li>
<li>Now commit the changes back to the repository.</li>
</ol>
<p>Don’t forget to uncheck <em>Stop on copy/rename</em> option in the <em>Log messages</em> dialog if you are trying to see the history of the moved directory.</p>
<p><img src="http://cdn.rajeeshcv.com/images/2011/11/20111115081442_Screen3_thumb.png" alt="Move configuration"></p>
<h3 id="Scenario_2_–_Moving_directories_across_SVN_repositories">Scenario 2 – Moving directories across SVN repositories</h3><p>In this case I want to move <strong>Project</strong> directory to another repository <strong>Repo2</strong></p>
<p>The first technique I have mentioned will work only if the source and target are under same repository, but in some cases you have to move the directories across different SVN repositories. This cannot be done from a SVN client slike TortoiseSVN, you need o use the utilities that comes with SVN.</p>
<p>Follow these steps</p>
<ol>
<li>Dump the repository to a file using the <code>svnadmin</code> tool – e.g. <code>svnadmin dump c:\Repositories\Repo1 &gt; Repo1file</code></li>
<li>Now load the dumped filed into the target repository – e.g. <code>svnadmin load c:\Repositories\Repo2 &lt; Repo1file</code></li>
</ol>
<p>Here is the full syntax for svnadmin tool</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">$ svnadmin dump --help</span><br><span class="line">dump: usage: svnadmin dump REPOS_PATH [-r LOWER[:UPPER] ] [--incremental]</span><br><span class="line"></span><br><span class="line">Dump the contents of filesystem to stdout <span class="keyword">in</span> a <span class="string">'dumpfile'</span></span><br><span class="line">portable format, sending feedback to stderr. Dump revisions</span><br><span class="line">LOWER rev through UPPER rev. If no revisions are given, dump all</span><br><span class="line">revision trees. If only LOWER is given, dump that one revision tree.</span><br><span class="line">If --incremental is passed, <span class="keyword">then</span> the first revision dumped will be</span><br><span class="line">a diff against the previous revision, instead of the usual fulltext.</span><br><span class="line"></span><br><span class="line">Valid options:</span><br><span class="line">-r [--revision] arg : specify revision number ARG (or X:Y range)</span><br><span class="line">--incremental  : dump incrementally</span><br><span class="line">--deltas   : use deltas <span class="keyword">in</span> dump output</span><br><span class="line">-q [--quiet]  : no progress (only errors) to stderr</span><br></pre></td></tr></table></figure>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://rajeeshcv.com/2011/11/15/How-to-Move-Directories-Across-SVN-Repositories/" data-id="ciffni8sn000nisktto3lk13l" class="article-share-link">Share</a>
      
        <a href="http://rajeeshcv.com/2011/11/15/How-to-Move-Directories-Across-SVN-Repositories/#disqus_thread" class="article-comment-link">Comments</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-Stay-Away-from-Request-Url" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2011/10/30/Stay-Away-from-Request-Url/" class="article-date">
  <time datetime="2011-10-30T09:30:09.000Z" itemprop="datePublished">2011-10-30</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2011/10/30/Stay-Away-from-Request-Url/">Stay Away from Request.Url</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>The title might be misleading but I will explain why we shouldn’t use the Request.Url in any asp.net application directly.</p>
<p>If you are writing an web application and you don’t know the environment of the server where it is getting deployed, then it is better not to use <code>Request.Url</code> it directly.</p>
<p><img src="http://cdn.rajeeshcv.com/images/2011/10/20111030073847_image_2.png" alt=""></p>
<p>This blog is running on a <a href="/2011/10/27/New-Outlook–Rolling-out-My-Own-Blog-Engine/" title="home grown blog engine">home grown blog engine</a>, which is written using asp.net MVC 3. For implementing some of the functionalities like generating sitemap.xml I had to get the root of the url(i.e. without any path). So I used the <code>Request.Url.GetLeftPart(UriPartial.Authority)</code> method and it worked perfectly on my local machine even when it is deployed my local machine IIS server. When I deployed my blog engine to <a href="https://appharbor.com" target="_blank" rel="external">Appharbor</a> environment, the generated sitemap.xml has a URL with port number like <em>www.rajeeshcv.com:4566</em> instead of just <em>www.rajeeshcv.com</em>.</p>
<h3 id="Why?">Why?</h3><p>After googling for some time I came across the solution posted <a href="https://appharbor.com" target="_blank" rel="external">Appharbor</a> knowledge base - <a href="https://support.appharbor.com/kb/getting-started/workaround-for-generating-absolute-urls-without-port-number" target="_blank" rel="external">workaround for generating absolute urls without port number</a>. In their environment there are load balancers which sits in front on the webserver, which uses a specific port number for contacting the server where the application is running. Below is a simple pictorial representation of that</p>
<p><img src="http://cdn.rajeeshcv.com/images/2011/10/20111030073858_image_4.png" alt="Network with load balancer"></p>
<p>So whenever we try to get <code>Request.Url</code>, application will get the actual request Url received by that webserver, which will have the port number also.</p>
<h3 id="How_to_solve_it">How to solve it</h3><p>Appharbor has provided a code snippet in the same article but it didn’t worked for me, I was still getting port number in the generated Url. My assumption is that, there is condition check for ignoring the local request so that it will work correctly in the local development environment.</p>
<figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (httpContext.Request.IsLocal)</span><br><span class="line">&#123;</span><br><span class="line">    uriBuilder.Port = httpContext.Request.Url.Port;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>According to the MSDN documentation</p>
<blockquote>
<p>The <code>IsLocal</code> property returns true if the IP address of the request originator is 127.0.0.1 or if the IP address of the request is the same as the server’s IP address.</p>
</blockquote>
<p>In my case I think <code>IsLocal</code> was true (I really don’t the exact reason!!!). So instead of using the appharbor code snippet I came across a code from <a href="http://www.funnelweblog.com/" target="_blank" rel="external">FunnelWeb</a> which does the same (HttpRequestExtensions.cs)</p>
<p>Here is my version of that code</p>
<figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"><span class="xmlDocTag">///</span> <span class="xmlDocTag">&lt;summary&gt;</span></span></span><br><span class="line"><span class="comment"><span class="xmlDocTag">///</span> Environments the specific request URL.</span></span><br><span class="line"><span class="comment"><span class="xmlDocTag">///</span> <span class="xmlDocTag">&lt;/summary&gt;</span></span></span><br><span class="line"><span class="comment"><span class="xmlDocTag">///</span> <span class="xmlDocTag">&lt;param name="request"&gt;</span>The request.<span class="xmlDocTag">&lt;/param&gt;</span></span></span><br><span class="line"><span class="comment"><span class="xmlDocTag">///</span> <span class="xmlDocTag">&lt;returns&gt;</span><span class="xmlDocTag">&lt;/returns&gt;</span></span></span><br><span class="line"><span class="comment"><span class="xmlDocTag">///</span> <span class="xmlDocTag">&lt;remarks&gt;</span></span></span><br><span class="line"><span class="comment"><span class="xmlDocTag">///</span> Code from FunnelWeb:  https://bitbucket.org/TheBlueSky/funnelweb/src/b64c74f361d3/src/FunnelWeb/Utilities/HttpRequestExtensions.cs</span></span><br><span class="line"><span class="comment"><span class="xmlDocTag">///</span> <span class="xmlDocTag">&lt;/remarks&gt;</span></span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Uri <span class="title">EnvironmentSpecificRequestUrl</span>(<span class="params"><span class="keyword">this</span> HttpRequestBase request</span>)</span><br><span class="line"></span>&#123;</span><br><span class="line"></span><br><span class="line">    UriBuilder hostUrl = <span class="keyword">new</span> UriBuilder();</span><br><span class="line">    <span class="keyword">string</span> hostHeader = request.Headers[<span class="string">"Host"</span>];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (hostHeader.Contains(<span class="string">":"</span>))</span><br><span class="line">    &#123;</span><br><span class="line">        hostUrl.Host = hostHeader.Split(<span class="string">':'</span>)[<span class="number">0</span>];</span><br><span class="line">        hostUrl.Port = Convert.ToInt32(hostHeader.Split(<span class="string">':'</span>)[<span class="number">1</span>]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">        hostUrl.Host = hostHeader;</span><br><span class="line">        hostUrl.Port = -<span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    Uri url = request.Url;</span><br><span class="line">    UriBuilder uriBuilder = <span class="keyword">new</span> UriBuilder(url);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (String.Equals(hostUrl.Host, <span class="string">"localhost"</span>, StringComparison.OrdinalIgnoreCase) || hostUrl.Host == <span class="string">"127.0.0.1"</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// Do nothing</span></span><br><span class="line">        <span class="comment">// When we're running the application from localhost (e.g. debugging from Visual Studio), we'll keep everything as it is.</span></span><br><span class="line">        <span class="comment">// We're not using request.IsLocal because it returns true as long as the request sender and receiver are in same machine.</span></span><br><span class="line">        <span class="comment">// What we want is to only ignore the requests to 'localhost' or the loopback IP '127.0.0.1'.</span></span><br><span class="line">        <span class="keyword">return</span> uriBuilder.Uri;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// When the application is run behind a load-balancer (or forward proxy), request.IsSecureConnection returns 'true' or 'false'</span></span><br><span class="line">    <span class="comment">// based on the request from the load-balancer to the web server (e.g. IIS) and not the actual request to the load-balancer.</span></span><br><span class="line">    <span class="comment">// The same is also applied to request.Url.Scheme (or uriBuilder.Scheme, as in our case).</span></span><br><span class="line">    <span class="keyword">bool</span> isSecureConnection = String.Equals(request.Headers[<span class="string">"X-Forwarded-Proto"</span>], <span class="string">"https"</span>, StringComparison.OrdinalIgnoreCase);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (isSecureConnection)</span><br><span class="line">    &#123;</span><br><span class="line">        uriBuilder.Port = hostUrl.Port == -<span class="number">1</span> ? <span class="number">443</span> : hostUrl.Port;</span><br><span class="line">        uriBuilder.Scheme = <span class="string">"https"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">        uriBuilder.Port = hostUrl.Port == -<span class="number">1</span> ? <span class="number">80</span> : hostUrl.Port;</span><br><span class="line">        uriBuilder.Scheme = <span class="string">"http"</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    uriBuilder.Host = hostUrl.Host;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> uriBuilder.Uri;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="Conclusion">Conclusion</h3><p>IMHO this is a limitation with .Net framework itself because here we have to modify the behaviour of the framework class to achieve what we really want . If there is way in which the IIS web server can detect the topology on which it is running, then the <code>HttpRequest.Url</code> could be implemented correctly. So that the developer need not to worry about the deployment scenarios(at least in this simple case).</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://rajeeshcv.com/2011/10/30/Stay-Away-from-Request-Url/" data-id="ciffni8rs0009isktxhiv9sof" class="article-share-link">Share</a>
      
        <a href="http://rajeeshcv.com/2011/10/30/Stay-Away-from-Request-Url/#disqus_thread" class="article-comment-link">Comments</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-New-Outlook–Rolling-out-My-Own-Blog-Engine" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2011/10/27/New-Outlook–Rolling-out-My-Own-Blog-Engine/" class="article-date">
  <time datetime="2011-10-27T09:21:11.000Z" itemprop="datePublished">2011-10-27</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2011/10/27/New-Outlook–Rolling-out-My-Own-Blog-Engine/">New Outlook – Rolling out My Own Blog Engine</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>For the last couple of years I was using wordpress as my blogging platform, it is an awesome framework but finally I decided to move away from it and created my own blog engine(Rhyble), on which this blog is running now.</p>
<p><a href="http://rhyble.apphb.com/" target="_blank" rel="external">Rhyble</a> is built using Asp.Net MVC3, NHiberanate and it is running Appharbor</p>
<p><img src="http://cdn.rajeeshcv.com/images/2011/10/20111027084419_image_2.png" alt=""></p>
<p>You might ask why I want reinvent the wheel again because we have many blog engines available today. Jeff Atwood answered that question here - <a href="http://stackoverflow.com/questions/471940/why-does-every-man-and-his-dog-want-to-code-a-blogging-engine/471944#471944" target="_blank" rel="external">Why does every man and his dog want to code a blogging engine?</a></p>
<p>These were my objectives when I started creating Rhyble</p>
<ol>
<li>Focus on the most important functionalities, doesn’t want to create another wordpress with truck full of unwanted things</li>
<li>Improve the performance. Now I have <a href="http://yslow.org/" target="_blank" rel="external">YSlow</a> rating of 94 compared to 65<br>image</li>
<li>I didn’t wanted to go through the existing blog engines code base, which is more time consuming than creating a new one</li>
</ol>
<p><img src="http://cdn.rajeeshcv.com/images/2011/10/20111027084442_image_thumb_1.png" alt="YSlow previous and current ratings"></p>
<p>More over it is a nice feeling if you have something you own. Now I have platform of my own and next things should be blogging frequently.</p>
<p>That’s it for the day.</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://rajeeshcv.com/2011/10/27/New-Outlook–Rolling-out-My-Own-Blog-Engine/" data-id="ciffni8s8000eiskt7i5dsiga" class="article-share-link">Share</a>
      
        <a href="http://rajeeshcv.com/2011/10/27/New-Outlook–Rolling-out-My-Own-Blog-Engine/#disqus_thread" class="article-comment-link">Comments</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-Web-Usability–Avoid-an-Extra-Page-Load-with-OpenSearch" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2011/04/05/Web-Usability–Avoid-an-Extra-Page-Load-with-OpenSearch/" class="article-date">
  <time datetime="2011-04-05T09:10:55.000Z" itemprop="datePublished">2011-04-05</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2011/04/05/Web-Usability–Avoid-an-Extra-Page-Load-with-OpenSearch/">Web Usability – Avoid an Extra Page Load with OpenSearch</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>Now a days most of the websites, blogs or any applications that are on internet will have a search functionality which is great!!!. Before the Omnibox concept was introduced by google chrome, if we want to search something in google, as a user I need to go to www.google.com and type the search query. After the introduction of Omnibox, user don’t need to open the google website instead you could do the search from the address bar itself. From the usability point of view, it is a great functionality IMHO.</p>
<p>From the point of google search application, they have done it smartly. As a web developer how could you provide the same usability feature to your own website. Some of the website I frequently visits has done like this.</p>
<p><img src="http://cdn.rajeeshcv.com/images/2011/04/clip_image001_thumb.png" alt="StackOverflow Opensearch"></p>
<p>If you are in google chrome, after you type the stackoverflow.com a message will be displayed on the address bar saying that <em>Press Tab to search Stack Overflow</em>. If you press tab, you can directly type the search query in the address bar itself and pressing enter will show the results. This basically allows you to do a quick search, instead of going to the website and finding the search box and pressing search button(a long process is it? Smile)</p>
<p>Recently I was working on a hobby project called <a href="http://ifscfinder.apphb.com/" target="_blank" rel="external">ifscfinder</a> , which is a website were you could search for a <em>Indian Finacial System Code</em> of any banks in India. It simply provide a search box where user could enter the Bank/Branch name and it will list the banks that matches the  query.  So I wanted to have the same feature like stackoverflow in my <a href="http://ifscfinder.apphb.com/" target="_blank" rel="external">ifscfinder</a> too.</p>
<p>After googling for sometime, I found about the opensearch which helps to achieve this functionality. You could read more about opensearch from here <a href="http://www.opensearch.org" target="_blank" rel="external">http://www.opensearch.org</a></p>
<p>What I had do was, create an xml file(OpenSearch description document), it will have URL format which needs to be called when user enter a search query. ifscfinder xml file looks like this</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="pi">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">OpenSearchDescription</span> <span class="attribute">xmlns</span>=<span class="value">"http://a9.com/-/spec/opensearch/1.1/"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="title">ShortName</span>&gt;</span>IFSC Finder<span class="tag">&lt;/<span class="title">ShortName</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="title">Description</span>&gt;</span>Search IFSC: Find  Indian Financial System Code of a Bank<span class="tag">&lt;/<span class="title">Description</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="title">InputEncoding</span>&gt;</span>UTF-8<span class="tag">&lt;/<span class="title">InputEncoding</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="title">Url</span> <span class="attribute">type</span>=<span class="value">"text/html"</span></span><br><span class="line">       <span class="attribute">template</span>=<span class="value">"http://ifscfinder.apphb.com/Search?q=&#123;searchTerms&#125;"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="title">OpenSearchDescription</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>After this is created, I upload it the website. In order for the browser to sense whether my website opensearch, I had to add link tag to the head element</p>
<p><code>&lt;link rel=&quot;search&quot; type=&quot;application/opensearchdescription+xml&quot; title=&quot;IFSCFinder.com&quot; href=&quot;/opensearchdescription.xml&quot; /&gt;</code></p>
<p>With this <a href="http://ifscfinder.apphb.com/" target="_blank" rel="external">ifscfinder</a> has got a nice quick search option in google chrome</p>
<p><img src="http://cdn.rajeeshcv.com/images/2011/04/clip_image002_thumb.png" alt="ifscfinder opensearch"></p>
<p>Firefox also detect the opensearch , which mean you could add this site to the search engine list in firefox</p>
<p><img src="http://cdn.rajeeshcv.com/images/2011/04/image_thumb.png" alt="Firefox Opensearch"></p>
<p>IE9 doesn’t care about this at all(don’t know why!!!)</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://rajeeshcv.com/2011/04/05/Web-Usability–Avoid-an-Extra-Page-Load-with-OpenSearch/" data-id="ciffni8rc0005isktxls2gv2d" class="article-share-link">Share</a>
      
        <a href="http://rajeeshcv.com/2011/04/05/Web-Usability–Avoid-an-Extra-Page-Load-with-OpenSearch/#disqus_thread" class="article-comment-link">Comments</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-MVC-Rendering-View-Elements-in-a-Specified-Order" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2011/02/27/MVC-Rendering-View-Elements-in-a-Specified-Order/" class="article-date">
  <time datetime="2011-02-27T09:01:29.000Z" itemprop="datePublished">2011-02-27</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2011/02/27/MVC-Rendering-View-Elements-in-a-Specified-Order/">MVC - Rendering View Elements in a Specified Order</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>In my current project, I had to render elements in the view based on a setting provided by the model(basically it is a configurable thing). Few clients need view element to be rendered in a particular order and few others in a different way. What we did was, saved this elements order in a settings file which could be changed based on the clients. Then created an extension to render this based on the order.</p>
<p>This is what was I was trying to explain. for  Client 1 the <em>Login section</em> to be displayed first followed by <em>Password reminder section</em></p>
<p><img src="http://cdn.rajeeshcv.com/images/2011/02/image_thumb.png" alt="Client 1 requirement"></p>
<p>For Client 2 , these sections needs be ordered differently</p>
<p><img src="http://cdn.rajeeshcv.com/images/2011/02/image_thumb1.png" alt="Client 2 requirement"></p>
<p>In order to achieve this, I came up with an <code>HtmlHelper</code> extension</p>
<figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"><span class="xmlDocTag">///</span> <span class="xmlDocTag">&lt;summary&gt;</span></span></span><br><span class="line"><span class="comment"><span class="xmlDocTag">///</span> Renders the render items in the provided sequence order.</span></span><br><span class="line"><span class="comment"><span class="xmlDocTag">///</span> <span class="xmlDocTag">&lt;/summary&gt;</span></span></span><br><span class="line"><span class="comment"><span class="xmlDocTag">///</span> <span class="xmlDocTag">&lt;param name="htmlHelper"&gt;</span>The HTML helper which is extended.<span class="xmlDocTag">&lt;/param&gt;</span></span></span><br><span class="line"><span class="comment"><span class="xmlDocTag">///</span> <span class="xmlDocTag">&lt;param name="sequenceOrder"&gt;</span>The order in which items to be rendered. Sequence starts at an index of 0.<span class="xmlDocTag">&lt;/param&gt;</span></span></span><br><span class="line"><span class="comment"><span class="xmlDocTag">///</span> <span class="xmlDocTag">&lt;param name="renderItems"&gt;</span>The items to be rendered in order.<span class="xmlDocTag">&lt;/param&gt;</span></span></span><br><span class="line"><span class="comment"><span class="xmlDocTag">///</span> <span class="xmlDocTag">&lt;remarks&gt;</span></span></span><br><span class="line"><span class="comment"><span class="xmlDocTag">///</span> Values in the sequence order should match with the total number of render items.</span></span><br><span class="line"><span class="comment"><span class="xmlDocTag">///</span> Invalid sequnce numbers are ignored.</span></span><br><span class="line"><span class="comment"><span class="xmlDocTag">///</span> <span class="xmlDocTag">&lt;/remarks&gt;</span></span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">OrderBy</span>(<span class="params"><span class="keyword">this</span> HtmlHelper htmlHelper, <span class="keyword">int</span>[] sequenceOrder, <span class="keyword">params</span> Action&lt;HtmlHelper&gt;[] renderItems</span>)</span><br><span class="line"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (sequenceOrder != <span class="keyword">null</span> &amp;&amp; renderItems != <span class="keyword">null</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">foreach</span> (<span class="keyword">var</span> sequnce <span class="keyword">in</span> sequenceOrder)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">// CHeck whether the sequence is with inthe bounds</span></span><br><span class="line">            <span class="keyword">if</span> (sequnce &lt; renderItems.Length &amp;&amp; sequnce &gt;= <span class="number">0</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                renderItems[sequnce].Invoke(htmlHelper);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">else</span> <span class="title">if</span> (<span class="params">renderItems != <span class="keyword">null</span></span>)</span><br><span class="line">    </span>&#123;</span><br><span class="line">        <span class="comment">// If the sequence order is not provided, render it in normal order in which items are declared.</span></span><br><span class="line">        <span class="keyword">foreach</span> (<span class="keyword">var</span> renderItem <span class="keyword">in</span> renderItems)</span><br><span class="line">        &#123;</span><br><span class="line">            renderItem.Invoke(htmlHelper);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// Do Nothing</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>In the view, you could do</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#60;% Html.OrderBy(this.Model.LoginDisplayOrder, (html) =&#62; &#123; %&#62;&#10;    &#60;div class=&#34;container&#34;&#62;&#60;/div&#62;&#10;    &#60;% Html.RenderPartial(&#34;LoginSection&#34;, this.Model); %&#62;&#10;&#60;% &#125;, (html) =&#62; &#123; %&#62;&#10;    &#60;div class=&#34;container&#34;&#62;&#60;/div&#62;&#10;    &#60;% Html.RenderPartial(&#34;ReminderPassword&#34;, this.Model); %&#62;&#10;&#60;% &#125;); %&#62;</span><br></pre></td></tr></table></figure>
<p>Here <code>Model.LoginDisplayOrder</code> is just an array of integers in which the items to be rendered.</p>
<p>Hope this will help.</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://rajeeshcv.com/2011/02/27/MVC-Rendering-View-Elements-in-a-Specified-Order/" data-id="ciffni8s8000gisktd0lp37vw" class="article-share-link">Share</a>
      
        <a href="http://rajeeshcv.com/2011/02/27/MVC-Rendering-View-Elements-in-a-Specified-Order/#disqus_thread" class="article-comment-link">Comments</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-Create-a-Live-Aquarium-Wallpaper-in-Android" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2010/12/27/Create-a-Live-Aquarium-Wallpaper-in-Android/" class="article-date">
  <time datetime="2010-12-27T07:26:03.000Z" itemprop="datePublished">2010-12-27</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2010/12/27/Create-a-Live-Aquarium-Wallpaper-in-Android/">Create a Live Aquarium Wallpaper in Android</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p><img src="http://cdn.rajeeshcv.com/images/2010/12/image_thumb.png" alt="Final Result 1"><br><img src="http://cdn.rajeeshcv.com/images/2010/12/image_thumb1.png" alt="Final Result 2"></p>
<p>Few weeks ago I started learning Android programming, so this article is an outcome of that out-side office study :). Here I will be explaining – how to create a live wallpaper which looks like an aquarium with fishes swimming across the screen. The fish animation is done using sprite technique.</p>
<p>Fish sprite used here is from a <a href="http://www.codeproject.com/KB/GDI-plus/LovelyGoldFishDeskPet.aspx" target="_blank" rel="external">code project article</a></p>
<p>Lets get started…</p>
<p>Creating a new Android project in eclipse (I am not familiar with any other IDEs for Android development :) ). Now create a class for your live wallpaper service, I called it as <code>AquariumWallpaperService</code>, then instantiate the <code>AquariumWallpaperEngine</code> which is responsible for creating the actual <code>Aquarium</code> class which does all the rendering logic. It also controls the flow of Aquarium based Surface callbacks Below is the code for  <code>AquariumWallpaperService</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AquariumWallpaperService</span> <span class="keyword">extends</span> <span class="title">WallpaperService</span> </span>&#123;</span><br><span class="line">  <span class="annotation">@Override</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> Engine <span class="title">onCreateEngine</span><span class="params">()</span> </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">new</span> AquariumWallpaperEngine();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="class"><span class="keyword">class</span> <span class="title">AquariumWallpaperEngine</span> <span class="keyword">extends</span> <span class="title">Engine</span></span>&#123;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">private</span> Aquarium _aquarium;</span><br><span class="line"></span><br><span class="line">      <span class="function"><span class="keyword">public</span> <span class="title">AquariumWallpaperEngine</span><span class="params">()</span> </span>&#123;</span><br><span class="line">          <span class="keyword">this</span>._aquarium = <span class="keyword">new</span> Aquarium();</span><br><span class="line">          <span class="keyword">this</span>._aquarium.initialize(getBaseContext(), getSurfaceHolder());</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="annotation">@Override</span></span><br><span class="line">      <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onVisibilityChanged</span><span class="params">(<span class="keyword">boolean</span> visible)</span> </span>&#123;</span><br><span class="line">          <span class="keyword">if</span>(visible)&#123;</span><br><span class="line">              <span class="keyword">this</span>._aquarium.render();</span><br><span class="line">          &#125;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="annotation">@Override</span></span><br><span class="line">      <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onSurfaceChanged</span><span class="params">(SurfaceHolder holder, <span class="keyword">int</span> format,</span><br><span class="line">              <span class="keyword">int</span> width, <span class="keyword">int</span> height)</span> </span>&#123;</span><br><span class="line">          <span class="keyword">super</span>.onSurfaceChanged(holder, format, width, height);</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="annotation">@Override</span></span><br><span class="line">      <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onSurfaceCreated</span><span class="params">(SurfaceHolder holder)</span> </span>&#123;</span><br><span class="line">          <span class="keyword">super</span>.onSurfaceCreated(holder);</span><br><span class="line">          <span class="keyword">this</span>._aquarium.start();</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="annotation">@Override</span></span><br><span class="line">      <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onSurfaceDestroyed</span><span class="params">(SurfaceHolder holder)</span> </span>&#123;</span><br><span class="line">          <span class="keyword">super</span>.onSurfaceDestroyed(holder);</span><br><span class="line">          <span class="keyword">this</span>._aquarium.stop();</span><br><span class="line">      &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>Aquarium</code> class wraps all the rendering logic, as well as creating the fishes. This also starts a thread which is responsible for updating the view.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Aquarium</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> AquariumThread _aquariumThread;</span><br><span class="line">    <span class="keyword">private</span> SurfaceHolder _surfaceHolder;</span><br><span class="line">    <span class="keyword">private</span> ArrayList&lt;Renderable&gt; _fishes;</span><br><span class="line">    <span class="keyword">private</span> Bitmap _backgroundImage;</span><br><span class="line">    <span class="keyword">private</span> Context _context;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">render</span><span class="params">()</span></span>&#123;</span><br><span class="line">        Canvas canvas = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">try</span>&#123;</span><br><span class="line"></span><br><span class="line">            canvas = <span class="keyword">this</span>._surfaceHolder.lockCanvas(<span class="keyword">null</span>);</span><br><span class="line">            <span class="keyword">synchronized</span> (<span class="keyword">this</span>._surfaceHolder) &#123;</span><br><span class="line">                <span class="keyword">this</span>.onDraw(canvas);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        &#125;<span class="keyword">finally</span>&#123;</span><br><span class="line">            <span class="keyword">if</span>(canvas != <span class="keyword">null</span>)&#123;</span><br><span class="line">                <span class="keyword">this</span>._surfaceHolder.unlockCanvasAndPost(canvas);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onDraw</span><span class="params">(Canvas canvas)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.renderBackGround(canvas);</span><br><span class="line">        <span class="keyword">for</span> (Renderable renderable : <span class="keyword">this</span>._fishes) &#123;</span><br><span class="line">            renderable.render(canvas);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">start</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">this</span>._aquariumThread.switchOn();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">stop</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">boolean</span> retry = <span class="keyword">true</span>;</span><br><span class="line">        <span class="keyword">this</span>._aquariumThread.switchOff();</span><br><span class="line">        <span class="keyword">while</span> (retry) &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="keyword">this</span>._aquariumThread.join();</span><br><span class="line">                retry = <span class="keyword">false</span>;</span><br><span class="line">            &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                <span class="comment">// we will try it again and again...</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getLeft</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getRight</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>._backgroundImage.getWidth();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">initialize</span><span class="params">(Context context, SurfaceHolder surfaceHolder)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>._aquariumThread = <span class="keyword">new</span> AquariumThread(<span class="keyword">this</span>);</span><br><span class="line">        <span class="keyword">this</span>._surfaceHolder = surfaceHolder;</span><br><span class="line">        <span class="keyword">this</span>._fishes = <span class="keyword">new</span> ArrayList&lt;Renderable&gt;();</span><br><span class="line">        <span class="keyword">this</span>._context = context;</span><br><span class="line">        BitmapFactory.Options options = <span class="keyword">new</span> BitmapFactory.Options();</span><br><span class="line">        options.inPurgeable = <span class="keyword">true</span>;</span><br><span class="line">        <span class="keyword">this</span>._backgroundImage = BitmapFactory.decodeResource(context.getResources(), com.plugai.android.livewallpapers.R.drawable.aquarium, options);</span><br><span class="line">        <span class="keyword">this</span>.addFishes();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">addFishes</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        Point startPoint = <span class="keyword">new</span> Point(<span class="number">100</span>, <span class="number">100</span>);</span><br><span class="line">        <span class="keyword">this</span>._fishes.add(<span class="keyword">new</span> ClownFish(<span class="keyword">this</span>._context, <span class="keyword">this</span>, startPoint, <span class="number">90</span>));</span><br><span class="line">        Point startPoint1 = <span class="keyword">new</span> Point(<span class="number">100</span>, <span class="number">300</span>);</span><br><span class="line">        <span class="keyword">this</span>._fishes.add(<span class="keyword">new</span> ClownFish(<span class="keyword">this</span>._context, <span class="keyword">this</span>, startPoint1, <span class="number">50</span>));</span><br><span class="line"></span><br><span class="line">        Point startPoint2 = <span class="keyword">new</span> Point(<span class="number">200</span>, <span class="number">200</span>);</span><br><span class="line">        <span class="keyword">this</span>._fishes.add(<span class="keyword">new</span> ClownFish(<span class="keyword">this</span>._context, <span class="keyword">this</span>, startPoint2, <span class="number">15</span>));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">renderBackGround</span><span class="params">(Canvas canvas)</span></span><br><span class="line">    </span>&#123;</span><br><span class="line">        canvas.drawBitmap(<span class="keyword">this</span>._backgroundImage, <span class="number">0</span>, <span class="number">0</span>, <span class="keyword">null</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Here is the code for <code>AquariumThread</code> class</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AquariumThread</span> <span class="keyword">extends</span> <span class="title">Thread</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Aquarium _aquarium;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">boolean</span> _running;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">AquariumThread</span><span class="params">(Aquarium aquarium)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>._aquarium = aquarium;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">switchOn</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">this</span>._running = <span class="keyword">true</span>;</span><br><span class="line">        <span class="keyword">this</span>.start();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">pause</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">this</span>._running = <span class="keyword">false</span>;</span><br><span class="line">        <span class="keyword">synchronized</span>(<span class="keyword">this</span>)&#123;</span><br><span class="line">            <span class="keyword">this</span>.notify();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">switchOff</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">this</span>._running = <span class="keyword">false</span>;</span><br><span class="line">        <span class="keyword">synchronized</span>(<span class="keyword">this</span>)&#123;</span><br><span class="line">            <span class="keyword">this</span>.notify();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="annotation">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">while</span>(<span class="keyword">this</span>._running)&#123;</span><br><span class="line">            <span class="keyword">this</span>._aquarium.render();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>All the <em>renderable</em> object in the aquarium must implement an interface <code>Renderable</code>, which has got one single method called <code>render(…)</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.plugai.android.livewallpapers;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> android.graphics.Canvas;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Renderable</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">render</span><span class="params">(Canvas canvas)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>This interface helps to render an object other than a fish, like plants etc… in future. I have created another abstract class which has common functionalities like changing the position and direction of a fish after a particular interval and called it as <code>AquaticAnimal</code>, this is because I could create specific fishes which just differ by it’s look by extending from this class.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">AquaticAnimal</span> <span class="keyword">implements</span> <span class="title">Renderable</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">int</span> MAX_SPEED = <span class="number">100</span>;</span><br><span class="line">    <span class="keyword">private</span> Context _context;</span><br><span class="line">    <span class="keyword">private</span> Aquarium _aquarium;</span><br><span class="line">    <span class="keyword">private</span> FishSprite _leftSprite;</span><br><span class="line">    <span class="keyword">private</span> FishSprite _rightSprite;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> _direction = -<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> _speedFraction;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">long</span> _previousTime;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">AquaticAnimal</span><span class="params">(Context context, Aquarium aquarium)</span></span>&#123;</span><br><span class="line">        <span class="keyword">this</span>._context = context;</span><br><span class="line">        <span class="keyword">this</span>._aquarium = aquarium;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">initialize</span><span class="params">(Bitmap leftBitmap, Bitmap rightBitmap, <span class="keyword">int</span> fps, <span class="keyword">int</span> totalFrames, Point startPoint, <span class="keyword">int</span> speed)</span></span>&#123;</span><br><span class="line">        <span class="keyword">this</span>._leftSprite = <span class="keyword">new</span> FishSprite(leftBitmap, fps, totalFrames, startPoint);</span><br><span class="line">        <span class="keyword">this</span>._rightSprite = <span class="keyword">new</span> FishSprite(rightBitmap, fps, totalFrames, startPoint);</span><br><span class="line">        <span class="keyword">this</span>._speedFraction = (MAX_SPEED / speed) * <span class="number">10</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> FishSprite <span class="title">getSprite</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">this</span>._direction &lt; <span class="number">0</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">this</span>._leftSprite;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>._rightSprite;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getDirection</span><span class="params">()</span></span>&#123;</span><br><span class="line">        FishSprite sprite = <span class="keyword">this</span>.getSprite();</span><br><span class="line">        <span class="keyword">int</span> xPos = sprite.getXPos();</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">this</span>._direction &lt; <span class="number">0</span>)&#123;</span><br><span class="line">            xPos += sprite.getWidth();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(xPos &lt; <span class="keyword">this</span>._aquarium.getLeft())&#123;</span><br><span class="line">            <span class="keyword">this</span>._direction = <span class="number">1</span>;</span><br><span class="line">        &#125;<span class="keyword">else</span> <span class="keyword">if</span>(xPos &gt; <span class="keyword">this</span>._aquarium.getRight())&#123;</span><br><span class="line">            <span class="keyword">this</span>._direction = -<span class="number">1</span>;</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="comment">// Do nothing</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>._direction;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Context <span class="title">getContext</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>._context;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Aquarium <span class="title">getAquarium</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>._aquarium;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="annotation">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">render</span><span class="params">(Canvas canvas)</span></span>&#123;</span><br><span class="line">        <span class="keyword">long</span> currentTime = System.currentTimeMillis();</span><br><span class="line">        <span class="keyword">this</span>.getSprite().render(canvas, currentTime);</span><br><span class="line">        <span class="keyword">this</span>.swim(currentTime);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">swim</span><span class="params">(<span class="keyword">long</span> currentTime)</span></span>&#123;</span><br><span class="line">        <span class="keyword">long</span> diff = currentTime - <span class="keyword">this</span>._previousTime;</span><br><span class="line">        <span class="keyword">if</span>(diff &gt; <span class="keyword">this</span>._speedFraction)&#123;</span><br><span class="line">            <span class="keyword">int</span> currentX = <span class="keyword">this</span>.getSprite().getXPos();</span><br><span class="line">            <span class="keyword">this</span>.getSprite().setXPos(currentX + <span class="keyword">this</span>.getDirection());</span><br><span class="line">            <span class="keyword">this</span>._previousTime = currentTime;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>The sprite animation is moved into a specific class <code>FishSprite</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">FishSprite</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span><br><span class="line">     * Private fields</span><br><span class="line">     */</span></span><br><span class="line">    <span class="keyword">private</span> Bitmap _currentSpriteBitmap;</span><br><span class="line">    <span class="keyword">private</span> Rect _drawRect;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> _fps;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> _noOfFrames;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> _currentFrame;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">long</span> _timer;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> _spriteWidth;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> _spriteHeight;</span><br><span class="line">    <span class="keyword">private</span> Point _position;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">FishSprite</span><span class="params">(Bitmap spriteBitmap, <span class="keyword">int</span> fps, <span class="keyword">int</span> frameCount, Point startPoint)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">this</span>.initialize();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">this</span>._position = startPoint;</span><br><span class="line">        <span class="keyword">this</span>._currentSpriteBitmap = spriteBitmap;</span><br><span class="line">        <span class="keyword">this</span>._spriteHeight = spriteBitmap.getHeight();</span><br><span class="line">        <span class="keyword">this</span>._spriteWidth = spriteBitmap.getWidth() / frameCount;</span><br><span class="line">        <span class="keyword">this</span>._drawRect = <span class="keyword">new</span> Rect(<span class="number">0</span>,<span class="number">0</span>, <span class="keyword">this</span>._spriteWidth, <span class="keyword">this</span>._spriteHeight);</span><br><span class="line">        <span class="keyword">this</span>._fps = <span class="number">1000</span> / fps;</span><br><span class="line">        <span class="keyword">this</span>._noOfFrames = frameCount;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">initialize</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>._drawRect = <span class="keyword">new</span> Rect(<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>);</span><br><span class="line">        <span class="keyword">this</span>._timer = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">this</span>._currentFrame = <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">Update</span><span class="params">(<span class="keyword">long</span> currentTime)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(currentTime &gt; <span class="keyword">this</span>._timer + <span class="keyword">this</span>._fps ) &#123;</span><br><span class="line">            <span class="keyword">this</span>._timer = currentTime;</span><br><span class="line">            <span class="keyword">this</span>._currentFrame +=<span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span>(<span class="keyword">this</span>._currentFrame &gt;= <span class="keyword">this</span>._noOfFrames) &#123;</span><br><span class="line">                <span class="keyword">this</span>._currentFrame = <span class="number">0</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">this</span>._drawRect.left = <span class="keyword">this</span>._currentFrame * <span class="keyword">this</span>._spriteWidth;</span><br><span class="line">        <span class="keyword">this</span>._drawRect.right = <span class="keyword">this</span>._drawRect.left + <span class="keyword">this</span>._spriteWidth;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">render</span><span class="params">(Canvas canvas, <span class="keyword">long</span> currentTime)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">this</span>.Update(currentTime);</span><br><span class="line"></span><br><span class="line">        Rect dest = <span class="keyword">new</span> Rect(getXPos(), getYPos(), getXPos() + <span class="keyword">this</span>._spriteWidth,</span><br><span class="line">                        getYPos() + <span class="keyword">this</span>._spriteHeight);</span><br><span class="line"></span><br><span class="line">        canvas.drawBitmap(<span class="keyword">this</span>._currentSpriteBitmap, <span class="keyword">this</span>._drawRect, dest, <span class="keyword">null</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Point <span class="title">getPosition</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> _position;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setPosition</span><span class="params">(Point position)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>._position = position;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getYPos</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>._position.y;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getXPos</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>._position.x;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setYPos</span><span class="params">(<span class="keyword">int</span> y)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>._position.y = y;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setXPos</span><span class="params">(<span class="keyword">int</span> x)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>._position.x = x;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getWidth</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>._spriteWidth;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getHeight</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>._spriteHeight;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Now to the final bit, that is creating a fish. you might have noticed that I have created an object of <code>ClownFish</code>in the Aquarium class. <code>ClownFish</code> is just a derived class from <code>AquaticAnimal</code>, with a specific sprite image. So if you have sprite images for a shark, you could simple extend a new class for a shark with that image.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ClownFish</span> <span class="keyword">extends</span> <span class="title">AquaticAnimal</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> TOTAL_FRAMES_IN_SPRITE = <span class="number">20</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> CLOWN_FISH_FPS = <span class="number">20</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">ClownFish</span><span class="params">(Context context, Aquarium aquarium,  Point startPoint, <span class="keyword">int</span> speed)</span></span>&#123;</span><br><span class="line">        <span class="keyword">super</span>(context, aquarium);</span><br><span class="line">        BitmapFactory.Options options = <span class="keyword">new</span> BitmapFactory.Options();</span><br><span class="line">        options.inPurgeable = <span class="keyword">true</span>;</span><br><span class="line">        Bitmap leftBitmap = BitmapFactory.decodeResource(getContext().getResources(), com.plugai.android.livewallpapers.R.drawable.left, options);</span><br><span class="line">        BitmapFactory.Options options1 = <span class="keyword">new</span> BitmapFactory.Options();</span><br><span class="line">        options1.inPurgeable = <span class="keyword">true</span>;</span><br><span class="line">        Bitmap rightBitmap = BitmapFactory.decodeResource(getContext().getResources(), com.plugai.android.livewallpapers.R.drawable.right, options1);</span><br><span class="line">        <span class="keyword">this</span>.initialize(leftBitmap, rightBitmap, CLOWN_FISH_FPS, TOTAL_FRAMES_IN_SPRITE, startPoint, speed);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">render</span><span class="params">(Canvas canvas)</span></span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.render(canvas);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Please feel free to go through the code, If I haven’t explained clearly. Hope this article helped some way or other.</p>
<p><strong>Happy new year!!!</strong></p>
<blockquote>
<p>Full source code is available <a href="https://github.com/cvrajeesh/LiveAquariumWallpaper" target="_blank" rel="external">here</a></p>
</blockquote>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://rajeeshcv.com/2010/12/27/Create-a-Live-Aquarium-Wallpaper-in-Android/" data-id="ciffni8vl000visktrt50knfl" class="article-share-link">Share</a>
      
        <a href="http://rajeeshcv.com/2010/12/27/Create-a-Live-Aquarium-Wallpaper-in-Android/#disqus_thread" class="article-comment-link">Comments</a>
      
      
    </footer>
  </div>
  
</article>


  
  
    <nav id="page-nav">
      <a class="extend prev" rel="prev" href="/">&laquo; Prev</a><a class="page-number" href="/">1</a><span class="page-number current">2</span><a class="page-number" href="/page/3/">3</a><a class="page-number" href="/page/4/">4</a><a class="page-number" href="/page/5/">5</a><a class="extend next" rel="next" href="/page/3/">Next &raquo;</a>
    </nav>
  
</section>
        
          <aside id="sidebar">
  
    
  
    
  
    
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/10/">October 2015</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/05/">May 2015</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/06/">June 2014</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/08/">August 2013</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2012/12/">December 2012</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2012/08/">August 2012</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2011/12/">December 2011</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2011/11/">November 2011</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2011/10/">October 2011</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2011/04/">April 2011</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2011/02/">February 2011</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2010/12/">December 2010</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2010/09/">September 2010</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2010/06/">June 2010</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2010/04/">April 2010</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2010/02/">February 2010</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2010/01/">January 2010</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2009/12/">December 2009</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2009/06/">June 2009</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2009/05/">May 2009</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2008/10/">October 2008</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2008/06/">June 2008</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2008/05/">May 2008</a><span class="archive-list-count">1</span></li></ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recents</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2015/10/07/A-Different-Way-to-Organize-JavaScripts-in-ASP-Net-MVC/">A Different Way to Organize JavaScripts in ASP.Net MVC</a>
          </li>
        
          <li>
            <a href="/2015/05/08/How-to-Fill-Remaining-Height-with-a-Div/">How to Fill Remaining Height with a Div</a>
          </li>
        
          <li>
            <a href="/2015/05/07/Run-Gulp-Tasks-in-a-Predefined-Order/">Run Gulp Tasks in a Predefined Order</a>
          </li>
        
          <li>
            <a href="/2014/06/22/EmberJS-Error-Logging-in-Production/">EmberJS Error Logging in Production</a>
          </li>
        
          <li>
            <a href="/2014/06/12/EmberJS-How-to-Detect-User-Inactivity/">EmberJS - How to Detect User Inactivity</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2015 Rajeesh C V<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/about" class="mobile-nav-link">About</a>
  
    <a href="/projects" class="mobile-nav-link">Projects</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    
<script>
  var disqus_shortname = 'rajeeshcv';
  
  (function(){
    var dsq = document.createElement('script');
    dsq.type = 'text/javascript';
    dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/count.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>


<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css" type="text/css">
  <script src="/fancybox/jquery.fancybox.pack.js" type="text/javascript"></script>


<script src="/js/script.js" type="text/javascript"></script>

  </div>
</body>
</html>